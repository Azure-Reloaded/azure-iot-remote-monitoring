@using GlobalResources
@model Microsoft.Azure.Devices.Applications.RemoteMonitoring.Common.Models.ApiRegistrationModel

<div>
    <ul class="list_select_select_advanced_process">
        <li class="list_item_select_advanced_process">
            <h2 class="select_advanced_process_subhead">@Strings.ApiRegistrationTitle</h2>
            @if (Model.ApiRegistrationProvider == null)
            {
                <p class="select_advanced_process_description">
                    @Strings.ApiRegistrationDescription
                </p>
                <p>
                    <div class="form-group">
                        <select class="form-control" id="apiRegistrationApiSelection">
                            <option value="">@Strings.ApiRegistrationSelectOptionInitial</option>
                            <option value="Jasper">@Strings.ApiRegistrationSelectOptionJasper</option>
                            <option value="Ericsson">@Strings.ApiRegistrationSelectOptionEricsson</option>
                        </select>
                        <div class="api_check_field" id="apiRegistrationApiSelectionRequired">
                            @Strings.RequiredValue
                        </div>
                    </div>
                </p>
                    <p>
                        <button class="add_new_button" type="submit" id="apiRegistrationButton">
                            @Strings.Create
                        </button>
                    </p>
            }
            else
            {
                <p>
                    <button class="button_base edit_button" type="submit" id="apiRegistrationButton">
                        @Strings.Edit
                    </button>
                </p>
            }

        </li>
        <li class="list_item_select_advanced_process">
            <h2 class="select_advanced_process_subhead">@Strings.DeviceAssociationTitle</h2>
            <p class="select_advanced_process_description">
                @Html.Raw(@Strings.DeviceAssociationDescription)
            </p>
            <button class="add_new_button" type="submit" id="deviceAssociationButton">
                @Strings.Create
            </button>
        </li>
    </ul>
</div>
<script type="text/javascript">
    $(window).ready(
        function () {
            'use strict';

            var config = {
                subheadContent: '',
                goBackUrl: ''
            };

            var validateApiProviderFields = function () {
                var valOk = true;
                $("#apiRegistrationApiSelection").each(function () {
                    if (!$("#" + this.id).val()) {
                        $("#" + this.id + "Required").show();
                        valOk = false;
                    }
                });
                return valOk;
            }

            IoTApp.Advanced.initSubView(config);

            $('#apiRegistrationButton').click(
                function () {
                    var providerSelectFieldId = "#apiRegistrationApiSelection";
                    $(providerSelectFieldId + "Required").hide();
                    var selectedProvider = $(providerSelectFieldId).val();
                    if (!selectedProvider) {
                        $(providerSelectFieldId + "Required").show();
                        return;
                    }
                    debugger
                    switch (selectedProvider) {
                        case 'Jasper': {
                            IoTApp.Advanced.redirecToPartial('@Url.Action("ApiRegistrationJasper")');
                            break;
                        }
                        case 'Ericsson': {
                            IoTApp.Advanced.redirecToPartial('@Url.Action("ApiRegistrationEricsson")');
                            break;
                        }
                        default:
                            throw 'Selected provider ' + selectedProvider + ' is not supported';
                            break;

                    }
                }
            );

            $('#deviceAssociationButton').click(
                function () {
                    IoTApp.Advanced.redirecToPartial('@Url.Action("DeviceAssociation")');
                }
            );
        }
    );
</script>